{% extends "layout.html" %}

{% block title %}Campaign Results - Dazzlo Bulk Emailer{% endblock %}

{% block header_title %}📊 Email Campaign Results{% endblock %}
{% block header_subtitle %}Detailed report of your bulk email campaign{% endblock %}

{% block head_extra %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/results_styles.css') }}">
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 max-w-4xl mx-auto">
    <div class="stat-card success-card p-8 text-center animate-slide-in">
        <div class="text-6xl font-bold text-green-700 mb-3">{{ sent_count }}</div>
        <div class="text-2xl font-bold text-green-800 mb-2">✅ Successfully Sent</div>
    </div>
    
    <div class="stat-card error-card p-8 text-center animate-slide-in" style="animation-delay: 0.1s;">
        <div class="text-6xl font-bold text-red-700 mb-3">{{ failed_count }}</div>
        <div class="text-2xl font-bold text-red-800 mb-2">❌ Failed</div>
    </div>
</div>

{% if (sent_count + failed_count) > 0 %}
<div class="mb-10 max-w-4xl mx-auto animate-slide-in" style="animation-delay: 0.2s;">
    <div class="summary-card p-8">
        <h3 class="section-title text-2xl font-bold mb-6 text-center">📈 Campaign Performance</h3>
        <div class="flex items-center space-x-6">
            <div class="flex-1">
                {% set success_rate = (sent_count / (sent_count + failed_count)) * 100 %}
                <div class="flex justify-between text-sm font-semibold text-gray-700 mb-3">
                    <span>Success Rate</span>
                    <span class="text-lg">{{ "%.1f"|format(success_rate) }}%</span>
                </div>
                <div class="progress-bar h-4">
                    <div class="progress-fill h-4" style="width: {{ success_rate }}%"></div>
                </div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-gray-800">{{ sent_count + failed_count }}</div>
                <div class="text-sm text-gray-600 font-medium">Total Emails</div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="mb-10 animate-slide-in" style="animation-delay: 0.3s;">
    <h2 class="section-title text-3xl font-bold mb-6 text-center">📋 Detailed Email Log</h2>
    <div class="table-container max-w-6xl mx-auto">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                    <tr>
                        <th class="px-8 py-6 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Recipient</th>
                        <th class="px-8 py-6 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Status</th>
                        <th class="px-8 py-6 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">Details</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for result in results %}
                    <tr class="table-row">
                        <td class="px-8 py-6 font-semibold text-gray-900">{{ result.email }}</td>
                        <td class="px-8 py-6">
                            {% if result.status == 'Success' %}
                                <span class="status-badge status-success">✅ Success</span>
                            {% else %}
                                <span class="status-badge status-failed">❌ Failed</span>
                            {% endif %}
                        </td>
                        <td class="px-8 py-6 text-sm text-gray-700 max-w-md">{{ result.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="flex flex-col sm:flex-row gap-6 justify-center max-w-2xl mx-auto animate-slide-in" style="animation-delay: 0.4s;">
    <a href="/" class="action-btn flex-1 sm:flex-none flex justify-center items-center py-5 px-8 text-white">
        <span class="mr-3 text-xl">📤</span> Send Another Campaign
    </a>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/results_script.js') }}"></script>
{% endblock %}